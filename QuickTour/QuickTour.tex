% $Author$
% $Date$
% $Revision$

% HISTORY:
% 2006-12-01 - Andrew edited (split from FirstApp?)
% 2006-12-03 - Andrew first draft
% 2006-12-06 - Stef edit
% 2007-06-11 - Oscar edit
% 2007-07-03 - Stef review
% 2007-08-22 - Andrew corrections
% 2007-09-11 - Marcus review
% 2007-09-11 - Orla review
% 2009-07-04 - Oscar migrated to Pharo

%=================================================================
\ifx\wholebook\relax\else
% --------------------------------------------
% Lulu:
	\documentclass[a4paper,10pt,twoside]{book}
	\usepackage[
		papersize={6.13in,9.21in},
		hmargin={.75in,.75in},
		vmargin={.75in,1in},
		ignoreheadfoot
	]{geometry}
	\input{../common.tex}
	\pagestyle{headings}
	\setboolean{lulu}{true}
% --------------------------------------------
% A4:
%	\documentclass[a4paper,11pt,twoside]{book}
%	\input{../common.tex}
%	\usepackage{a4wide}
% --------------------------------------------
    \graphicspath{{figures/} {../figures/}}
	\begin{document}
	% \renewcommand{\nnbb}[2]{} % Disable editorial comments
	\sloppy
\fi
%=================================================================
\newcommand{\clover}{%
	\raisebox{-0.8ex}[0pt][0pt]{%
		\includegraphics[width=1em]{cloverleafKey}}}
%=================================================================
\chapter{\pharo の使い方}
\chalabel{quick}

この章では、\pharo の快適な使い方について解説します。
読書するばかりで無く、パソコンを用意して実際にPharoを使っていくことができれば、一層理解が深まると思います。

\pharo を使って実際に試してみてもらいたい箇所には、このアイコン: \dothisicon{} でマークしておきます。
\pharo の起動や、\pharo と対話する色々な方法を学んだり、基本的なツールを見つけたり、
メソッドの作成方法や、オブジェクトを作成し、それにメッセージを送る方法を学ぶことになるでしょう。

%=================================================================
\section{使ってみよう}

\pharo は \pharoweb から自由に \ind{download} することができます。
3種のパーツから構成されていますが、実際には4個のファイルをダウンロードすることになります(\figref{download})。

\begin{figure}[htb]
\centerline {\includegraphics[width=\textwidth]{annotatedDownload-flat}}
\caption{サポートしているOS毎にダウンロードする \pharo のファイル。\figlabel{download}}
\end{figure}

\begin{enumerate}

  \item \emphind{仮想マシン} (VM)。VMは、システムで唯一、各OSとCPU毎に異なるパーツです。主要なプラットフォーム用の、コンパイル済みの仮想マシンが手に入ります。\figref{download}には、Windows用のVMである \textit{Pharo.exe} があります。

  \item \emphind{sources} ファイル。sources ファイルは、\pharo のすべてのパーツのソースコードを含みます。このファイルは、ほぼ変更されることはありません。\figref{download} では \emph{SqueakV39.sources}が sources ファイルです。\footnote{\pharo は \squeak 3.9 をベースに作らています。現在のVMは、\squeak と同じものを使っています。}

  \item 現在の \emph{システム\ind{イメージ}}は、実行中の \pharo システムのスナップショットです。このスナップショットは二つのファイルからなります: \emph{.}\emphind{image} ファイル。 .image ファイルは、システムのすべてのオブジェクトの状態を含みます(クラスやメソッドも含みます。これらもオブジェクトです)と、 \emph{.}\emphind{changes} ファイル。 .changes ファイルは、システムのソースコードの変更のログをすべて含みます。
\figref{download}では、これらのファイルは、 \emph{pharo.image} 、 \emph{pharo.changes} となっています。
\end{enumerate}

\dothis{\pharo をダウンロードし、インストールしてみましょう。}
\pharo by Example のウェブページからイメージをダウンロードすることをお勧めします。\footnote{\pbe}
\index{download}
\seclabel{sbeImage}

ここで紹介する内容は、殆どが \pharo のどんなバージョンでも動作します。もし、\pharo を既にインストールしているのなら、それを使っても問題有りません。
しかし、外見や動作のちょっとした違いがあっても驚かないで下さいね。
% On the other hand, if you are about to download \pharo for the first time, you may as well grab the \emph{\pharo by Example} image.

\pharo で何か作業している時、 .image ファイルと .changes ファイルは常に内容が更新されているため、確実に書き込み可能ファイルにしてください。
そして、これらは二つのファイルは、常に同じ場所に置いて下さい。
また、これらを、絶対にテキストエディターで直接変更しないでください。\pharo はこれらを、オブジェクトを格納したり、ソースコードの変更のログを書き出すのに使います。
ダウンロードしたファイルのバックアップコピーを取っておくのは良い考えです。こうしておけばいつでも、フレッシュなイメージから \pharo を開始し、(それがセーブしてあれば)あなたのプログラムを読み込むことができます。

\emphind{sources} ファイルとVMは書き込み不可にすることが可能です\,---\,これらを複数のユーザーで共有することができます。
仮想マシン・sources ファイル・image ファイル・changes ファイルは、同じ場所に置いても構いませんし、仮想マシン・sources ファイルだけ別の共有ディレクトリに置いても構いません。
OSや作業スタイルに合わせて使ってください。

%\sd{it would be really nice to have a setup and startup section on PC, Mac and Linux}
%\ab{I agree entirely; the reason that this is not here is because I could do only the Mac section.  Damien can probably do Windoze.  Perhaps we can ask on the list for a Linux volunteer?}

%-----------------------------------------------------------------
\begin{figure}[htb]
% \centerline {\includegraphics[width=0.6\textwidth]{download}}
\centerline {\includegraphics[width=\textwidth]{startup}}
\caption{\pbe からダウンロードした状態の イメージ\figlabel{startup}}
\end{figure}

\index{launching \pharo}
\paragraph{起動してみましょう。} \pharo の起動は、普通のアプリケーションと同様です。仮想マシンのアイコンに \emph{.}\emphind{image} ファイルをドラッグ・アンド・ドロップしたり、 \emph{.image} ファイルをダブルクリックしたり、コマンドラインで、仮想マシンの名前の後に \emph{.image} へのパスを入力することになるでしょう。使っているOSに合わせて下さい(もし、異なるバージョンのVMを持っておく必要があるなら、どのVMが動作しているかはっきりさせるためにも、ドラッグ・アンド・ドロップまたはコマンドラインからの起動を勧めます)。

\pharo を起動すると、大きめのウィンドウが現れます。このウィンドウの中ではさらに複数のワークスペースウィンドウを開くことができます(\figref{startup})。しかし、このあとどう続けたらいいか、明かではありません!
メニューバーも有りますが、\pharo では主にコンテキスト(文脈)に依存したポップアップメニューを使うことになります。
% You will notice that there is no menu bar, or at least not a useful one.  
% Instead,  \pharo makes heavy use of context-dependent pop-up menus.

\dothis{\pharo を始めましょう。ウィンドウの左上にある赤いクローズボタンを \click すると、ワークスペースを閉じることができます。}

ウィンドウを最小化するにはオレンジ色のボタン、最大化するには緑色のボタンを \click してください。

%-----------------------------------------------------------------
\paragraph{最初の対話。}

\figref{threeButtons:click} のように、\ind{world メニュー} を表示しましょう。

\dothis{マウスカーソルがメインウィンドウの背景にある状態で、マウスのボタンをクリックし、world メニューを表示しましょう。そして、\menu{Workspace} を選択して、新しいワークスペースを出しましょう。}

%\begin{figure}[tbh]
%	\centering
%	\subfigure[The world menu]{\figlabel{threeButtons:click}% click
%		\includegraphics[width=0.25\linewidth]{worldMenu}}\hfill
%	\subfigure[The contextual menu]{\figlabel{threeButtons:actclick}% action click
%		\includegraphics[width=0.35\linewidth]{yellowButtonMenuOnWorkspace}}\hfill
%	\subfigure[The morphic halo]{\figlabel{threeButtons:metaclick}% meta click
%		\includegraphics[width=0.35\linewidth]{morphicHaloOnWorkspace}}% these braces needed (else no whitespace at end of line)
%	\caption{The world menu (brought up by \click{ing}), a contextual menu (\actclick{ing}), and a morphic \subind{Morphic}{halo} (\metaclick{ing}).\figlabel{threeButtons}}
%\end{figure}

\begin{figure}[tbh]
	\centering
	\subfigure[world メニュー]{\figlabel{threeButtons:click}% click
		\includegraphics[width=0.40\linewidth]{worldMenu}}\hfill
	\subfigure[コンテキストメニュー]{\figlabel{threeButtons:actclick}% action click
		\includegraphics[width=0.55\linewidth]{yellowButtonMenuOnWorkspace}}\hfill
	\subfigure[morphic ハロー]{\figlabel{threeButtons:metaclick}% meta click
		\includegraphics[width=0.60\linewidth]{morphicHaloOnWorkspace}}% these braces needed (else no whitespace at end of line)
	\caption{world メニュー(\click)、コンテキストメニュー(\actclick)、morphic \subind{Morphic}{ハロー} (\metaclick).\figlabel{threeButtons}}
\end{figure}
\seeindex{morphic ハロー}{Morphic}

%% ON: I had to shrink this and move it up to avoid
%% it running over the end of the page.
%\begin{wrapfigure}[19]{r}{0.25\linewidth}
%% The parameters are the number of narrow lines to the right of the figure [19],
%% the placement {r} for right, and the width of the figure. Capital R will allow some float.
%% Inside the wrapfig environment, linewidth is special --- the width of the figure.
%\includegraphics[width=0.95\linewidth]{colouredMouse}
%\caption{The author's mouse. \click{ing} the scroll wheel activates the blue button.}
%\figlabel{colouredMouse}
%\end{wrapfigure}

\st は、元々の設計時点から、3ボタンマウスを想定しています。使っているマウスのボタンが足りないときは、修飾キーを押しながらマウスボタンを\click してください。2ボタンマウスでも、十分に \pharo を使うことができますが、もし1ボタンマウスしか持っていなら、クリックできるスクロールホイールが付いた2ボタンマウスを買うことを、真剣に考えましょう: これだけで、\pharo を、よりいっそう快適に使うことができます。

色々なコンピューターやマウス、キーボード、個人環境が有るため、\pharo では「左マウスボタンのクリック」という表現は避けています。
元来、\st は異なるマウスボタンを色で表現していました。\footnote{マウスボタンの色は、\emph{赤}、\emph{黄}そして\emph{青}です。この本の著者は、どの色がどのボタンを指していたのか、さっぱり思い出せません。}
\index{赤ボタン}
\index{黄ボタン}
\index{青ボタン}
マウスボタンが違ったり、修飾キー(\emph{control}キー、\emph{ALT}キー、\emph{meta}キー、\etc)を押しながらマウスを使うような状況を統一するため、次の用語を使います:
\begin{description}
\item [\click:] 一番使われるマウスボタンで、普通は、修飾キー等を使わずに1ボタンマウスを \click するのと同じです; 背景部分を \click して 「World」 メニュー(\figref{threeButtons:click})を表示してみましょう。
\item [\actclick:] 次によく使われるボタンです; これはコンテキストメニューを表示するボタンです。コンテキストメニューは、マウスポインタが指している場所により違うメニュー表示を行うことがあります; \figref{threeButtons:actclick}を見てください。マルチボタンのマウスを使わない場合、普通は、\emph{control} 修飾キーを使って \actclick をすることになります。
\item [\metaclick:] 最後に、画面に表示されたどんなオブジェクトに対しても、それを \metaclick して 「morphic \subind{Morphic}{ハロー}」 を有効にすることができます。ハローは、画面上のオブジェクトを、回転させたりリサイズしたりするためのハンドルの集りです; \figref{threeButtons:metaclick} を見てください。\footnote{\pharo は、いくつかの Morphic ハンドルの操作を、標準で制限しています。以降の 「Preferences Browser の使い方」 には、その制限を外す方法も書いてあります。}
バルーンヘルプ機能もありますので、マウスの使い方に困ることはありません。
\pharo で \metaclick する方法は、使っているオペレーティングシステムに依存ます。
{\sc shift} \emph{ctrl} または {\sc shift} \emph{option} を押しながらクリックすることになります。
% \ab{This makes it sound like either {\sc shift} \emph{ctrl} or {\sc shift} \emph{alt} will work.  On my (Mac OS) system, only the latter works.  Perhaps we want to say: In \pharo, how you meta-click depends on your operating system. On Linux \ldots}
% Typically you will use a third modifier key, such as \emph{command} or \emph{meta} to \metaclick.
\end{description}

\dothis{\ct{Time now} とワークスペースに入力しましょう。
そして、ワークスペースで \actclick して、
\menu{print it} を選択しましょう。}

%Now we will activate \metaclick{ing}.

%\dothis{Open the preference browser (\menu{System {\ldots\go} Preferences {\ldots\go} Preference Browser\ldots}) and find the \menu{halosEnabled} option using the search box.}

%\begin{figure}[htb]
%\centerline{\includegraphics[width=\textwidth]{PreferenceBrowser}}
%\caption{The Preference Browser.\figlabel{prefBrowser}}
%\end{figure}

%\dothis{Now you should be able to \metaclick on the workspace. (See \figref{threeButtons:metaclick}.)
%Grab the blue \raisebox{-0.4ex}{\includegraphics[width=1em]{morphicRotate}} handle near the bottom left corner and drag it to rotate the workspace.}

右利きの人なら、\click は左ボタンに、\actclick は右ボタンに、クリックできるスクロールホイールがあるマウスなら、\metaclick をそれに設定することをお勧めします。
% If you don't have a clickable scroll wheel, then you can get the Morphic halo by holding down the \ct{alt} or \ct{option} key while \click{ing}. 
% \ab{This doesn't work any more.  This sentence either repeats or contradicts the meta-click item above; neither is a good idea.}
あなたが1ボタンのマウスで Macintosh を使っているのなら、\clover{} を押しながらマウスを \click することで、\actclick か \metaclick をシミュレートすることもできます。それでも、これから \pharo を頻繁に使おうと言うのなら、最低でも二つのボタンの付いたマウスに投資することを、お勧めします。

オペレーティングシステムのマウスドライバの設定を変えることで、あなた好みの動作を行うこともできます。
\ab{How can I get meta-click without a three-finger salute?  Is this a secret?}
\pharo は、キーボードのメタキーや、マウスの設定を変更できる機能も持っています。
Preference Browser (\menu{System {\ldots\go} Preferences {\ldots\go} Preference Browser\ldots})では、\menu{keyboard} カテゴリーの \menu{swapControlAndAltKeys} オプションを使うことで、\actclick と \metaclick の機能を交換することができます。
TODO: 識者に訳してもらう

\begin{figure}[htb]
\centerline{\includegraphics[width=\textwidth]{PreferenceBrowser}}
\caption{Preference Browser。\figlabel{prefBrowser}}
\end{figure}


%=================================================================
\section{Worldメニュー}
\index{worldメニュー}

\dothis{\pharo の背景で、もう一度 \click をしてみましょう。}
再び \menu{World} メニューが表示されるはずです。
\pharo のメニューは殆どがモーダルメニューではありませんので、右上の画鋲アイコンを \click することで、画面上に残しておくことができます。やってみましょう。
% Also, notice that menus appear when you click the mouse, but do not disappear when you release it; they stay visible until you make a selection, or until you click outside of the menu. You can even move the menu around by grabbing its title bar.

world メニューを使えば、\pharo の色々なツールに簡単にアクセスすることができます。

\dothis{\menu{World} と \menu{{}Tools \ldots} を良く見てみましょう(\figref{threeButtons:click})。}

そこには、ブラウザーやワークスペースと言った \pharo のコアツールが、いくつかリストされるでしょう。
次の章では、これらリストされたツールのほとんどを、見ることになります。

%=================================================================
\section{メッセージを送る}

\dothis{ワークスペースを開けましょう。そして以下のテキストを入力しましょう:}

\begin{code}{}
BouncingAtomsMorph new openInWorld
\end{code}

\dothis{\actclick でメニューを表示し、\menu{do it (d)} を選択しましょう(\figref{doit})。}

\begin{figure}[htb]
\centerline {\includegraphics[width=0.8\textwidth]{Doit}}
\caption{式を「do it」する。\figlabel{doit}}
\end{figure}

左上に、たくさんの原子が中で弾んでいるウインドウが、表示されたはずです。

あなたはたった今、最初の \st プログラムを評価したことになります!
\bam クラスへ \ct{new} メッセージを送り、生成された \bam のインスタンスに \ct{openInWorld} メッセージを送ったことになります。
\bam クラスは \ct{new} メッセージを理解しました。つまり、\ct{new} メッセージを扱う \emph{メソッド} を検索して、適切に動作しました。
同様に、\bam インスタンスも、\ct{openInWorld} に応答するメソッドを検索して、適切に動作しました。

Smalltalkerたちとしばらく話せば、あなたはすぐに、彼らが、「手続きをコールする」または、「メソッドを呼び出す」などの表現を使わず、代わりに、「メッセージを送る」と言うことに気付くでしょう。
これは、「オブジェクトは自分の動作に責任を持つ」というアイディアを反映しています。
あなたは決して 、オブジェクトに、何々をしろと\emph{命令する}ことはありません\,---\,代わに、メッセージを送って、何かしてほしいと、礼儀正しく\emph{頼み}ます。
あなたではなくオブジェクトが、メッセージを理解し、適切なメソッドを選択して実行します。

%=================================================================
\section{保存、終了と再起動について}

\dothis{先ほど表示させた弾む原子のウィンドウを \click クリックし、好きな所へウィンドウをドラッグしましょう。もう一度 \click して、ウィンドウを適当な場所に置きましょう。}

\begin{figure}[htb]
\begin{minipage}[b]{0.48\textwidth}
\centerline {\includegraphics[width=0.7\textwidth]{atoms}}
\caption{\bam。\figlabel{atoms}}
\end{minipage}
\hfill
\begin{minipage}[b]{0.48\textwidth}
\centerline {\includegraphics[width=0.7\textwidth]{saveAs}}
\caption{\menu{save as \ldots}ダイアログ。\figlabel{saveas}}
\end{minipage}
\end{figure}

\dothis{\menu{World\go{}Save as \ldots} を選択して、「myPharo」 と入力し、\button{OK} ボタンを押しましょう。
そして、\menu{World\go{}Save and quit} を選択しましょう。}

もともとの image ファイルと changes ファイルがあった場所に、「myPharo.\ind{image}」と「myPharo.\ind{changes}」ができているはずです。これらのファイルには、\menu{Save and quit}したときの \pharo の動作状態が入っています。
この二つのファイルは何処にでも移動させて構いませんが、(オペレーティングシステムによっては)仮想マシンと \emph{sources} ファイルも一緒にしておく必要があるかもしれません。

\dothis{今作った「myPharo.image」ファイルを使って \pharo を起動しましょう。}

先ほど \pharo を終了した時とそっくりそのままの状態に戻ったことに気付くはずです。\bam も同じところにあり、原子は弾み続けているでしょう。

\pharo を起動すると、\pharo \ind{仮想マシン}は、指定された image ファイルを読み込みます。このファイルには、たくさんのオブジェクトのスナップショットが入っています。これらのオブジェクトには、既に書かれた大量のコードや、多くのプログラミングツール(これらはすべて、オブジェクトです)が含まれます。\pharo を使っていると、オブジェクトへメッセージ送ったり、新しいオブジェクトを作ったりすることになります。また、いくつかのオブジェクトは命を終え、オブジェクトに割り当てられていたメモリーは回収(\ie ガベージコレクション)されます。

\pharo を終了するとき、通常はいわゆる上書き保存になります。あるいは、先ほど行ったみたいに、別名での保存もできます。

\emph{.image} ファイルとは別に、\emph{.changes} ファイルというものがあります。
このファイルは、標準のツールを使ってソースコードに対して行ったすべての変更を、記録しています。
通常、このファイルはあまり意識する必要はありません。
しかし、\emph{.changes} ファイルは、エラーを回復したり、保存しそこなった変更を再現するのに重宝します。
これについては、後ほど!

あなたが使ってきたイメージは、1970年代後半に作られた、オリジナルの \st-80 のイメージの子孫です。
このイメージの中には、何10年と生き続けているオブジェクトもあります。

ソフトウェアプロジェクトを保存・管理する方法として、イメージは重要なメカニズムであると考えるかも知れませんが、それは違います。
すぐ後で見るように、ソースコードを管理し、ソフトウェアをチームで共有するには、Monticello などの、もっと良いツールがあります。
イメージは非常に便利ですが、こうしたツールがあるので、イメージを、無造作に作ったり捨てたりすることに慣れましょう。

\dothis{マウス(必要ならば修飾キーを使って) \bam を \metaclick してみましょう。\footnote{うまくいかない場合は、Preferences Browser の \ct{halosEnabled} オプションをチェックしてみてください。}}
\bam の morphic \subind{Morphic}{ハロー} と呼ばれる、色とりどりの円が表示されたはずです。
それらの円は、\emph{ハンドル}と呼ばれます。
十字のピンクのハンドルをクリックすると、\bam は消えるはずです。

%=================================================================
\section{ワークスペースと Transcript}
\seclabel{transcript}

\dothis{すべてのウィンドウを閉じましょう。\ind{transcript} と \ind{ワークスペース}を新しく開きましょう。(transcript は、\menu{World{\go}Tools ...} のサブメニューにあります。)}

\dothis{transcript とワークスペースの位置やサイズを変えて、ワークスペースをtranscriptにオーバーラップさせましょう。}
ウィンドウをリサイズするには、ウィンドウの角をドラッグするか、\metaclick して morphic ハローを出し、右下の黄色のハンドルをドラッグします。

常に、1個のウィンドウだけがアクティブです; そのウィンドウは前面にあって、枠が強調されています。
% The mouse cursor must be in the window in which you wish to type.

transcript はシステムメッセージのログを確認するときに良く使われるオブジェクトです。
いわば、「システムコンソール」と言えるでしょう。
%Note that the transcript is terribly slow, so if you keep it open and write to it certain operations can become 10 times slower.
%In addition the transcript is not thread-safe so you may experience strange problems if multiple objects write concurrently to the transcript.
% ON: I think the transcript has been made thread-safe now, right?

ワークスペースは、実験的に試してみたい \st コードの断片を入力するのに役立ちます。
ワークスペースには、単に覚書のテキストを書いておくこともできます。TODOリストや、あなたのイメージを使う人への手引きなどに使えるでしょう。
ワークスペースは、しばしば、保存されたイメージについてのドキュメントとして使われます。先にダウンロードした標準のイメージが一例です(\figref{startup})。

\dothis{ワークスペースに次のテキストを入力しましょう。}
\begin{code}{}
Transcript show: 'hello world'; cr.
\end{code}

ワークスペースの中で、今入力したテキストの色々な箇所を、ダブル \click してみましょう。
単語の上、文字列の終り(\ct{'})、テキスト全体の終り(\ct{.})、という具合に \click してみて、単語全体、文字列全体、テキスト全体が選択される様子を確認しましょう。

\dothis{入力したテキスト全体を選択して、\actclick で
\menu{do it (d)} を選択します。}
transcript ウィンドウに「hello world」と表示されたのを確認しましょう
(\figref{helloworld})。
もう一度やってみましょう。
(\menu{do it (d)}の中の\menu{(d)} は、 \emph{do it}へのキーボードショートカットが \short{d}であることを示しています。これについて詳しい話は、次の節で!)

\begin{figure}[htb]
\centerline {\includegraphics[width=\textwidth]{HelloWorld}}
\caption{オーバーラップしたウィンドウ。ワークスペースがアクティブ。\figlabel{helloworld}}
\end{figure}

%=================================================================
\section{キーボードショートカット}

式を評価したいときは、\actclick ではなく \ind{キーボードショートカット}を使うこともできます。メニューの括弧書きの部分が該当します。ショートカットキーを使う時には、プラットフォームに応じて、control、alt、command、meta 等の修飾キーを同時に使用することになるでしょう
(このようなキーボードショートカットを、一般的に、\short{\emph{キー}}と表記することにします)。

\dothis{キーボードショートカットを使って、再びワークスペースの式を評価してみましょう: \short{d}。}
\index{キーボードショートカット!do it}

\menu{do it} だけでなく、\menu{print it}、 \menu{inspect it}、 \menu{explore it} にも気付いたでしょう。これらについて手短に説明します。

\dothis{\ct{3 + 4} とワークスペースの中に入力し、キーボードショートカットを使って \menu{do it} を実行してみましょう。}

何も起きなかったことに驚かないでください。ここでは数字の \ct{3} に数字の \ct{4} を引数とした \ct{+} メッセージを送ったことになります。普通に \ct{7} が計算され、返されたのですが、ワークスペースはこの答えをどうするべきか知らないので、答えを捨ててしまいます。結果を表示させたければ、\menu{print it} を使うことになります。\menu{print it} は、式をコンパイルし、実行し、その結果に \ct{printString} を送って得た文字列を表示します。

\dothis{\ct{3+4} を選択し、\menu{print it} を実行しましょう(\short{p})。}
今度は予想通りの結果です(\figref{printit})。
\index{キーボードショートカット!print it}

\begin{figure}[htb]
% \centerline {\includegraphics[width=0.4\textwidth]{PrintIt}}
\centerline {\includegraphics[width=0.8\textwidth]{PrintIt}}
\caption{「do it」ではなく「Print it」。\figlabel{printit}}
\end{figure}

\needlines{3}
\begin{code}{@TEST}
3 + 4 --> 7
\end{code}
\noindent
この本の習慣として、特定の \pharo の式を\menu{print it}したらどうなるかを示すのに、\ct{-->}の表記を用います。

\dothis{選択されている 「\ct{7}」 を削除し(\pharo は既に「\ct{7}」を選択しているはずです。だから、delete キーを押すだけです)、\ct{3+4}をもう一度選択してから、今度は \menu{inspect it} (\short{i})しましょう。}
\noindent
タイトルに\ct{SmallInteger: 7} (\figref{inspectit})と書かれた\emphind{インスペクター}ウィンドウが表示されるはずです。
inspector は極めて便利なツールで、これを用いれば、システムのどんなオブジェクトとも対話することができます。
タイトルの意味は、\ct{7} は \clsind{SmallInteger} クラスのインスタンスであるということです。
左のパネルはオブジェクトのインスタンス変数を示し、その値が右のパネルに表示されます。
下のパネルは、オブジェクトへメッセージを送るための式を記述することができます。

\begin{figure}[htb]
\centerline {\includegraphics[width=\textwidth]{InspectIt}}
\caption{オブジェクトをインスペクトする。\figlabel{inspectit}}
\end{figure}

\dothis{下のパネルに \ct{self squared}と入力し、\menu{print it}しましょう。}

\needlines{2}
\dothis{inspector を閉じ、\ct{Object} をワークスペースに入力して、今度は、\menu{explore it} (\short{I}, 大文字 i)してみましょう。}
\index{キーボードショートカット!explore it}
\index{explorer}

今度は、\clsind{Object} のタイトルが付いた、
\mbox{$\triangleright$ \ct{root: Object}} と表示されているウィンドウが開きます。
三角のアイコンを使って、中身を表示してください (\figref{exploreit})。

\begin{figure}[htb]
\centerline {\includegraphics[width=0.7\textwidth]{ExploreIt}}
\caption{\ct{Object}をエクスプロアする。\figlabel{exploreit}}
\end{figure}

エクスプローラーはインスペクターと似ていますが、複雑なオブジェクトの中身をツリー表示します。
この例でエクスプロアされているオブジェクトは、\ct{Object}クラスです。
TODO: 識者に訳してもらう

%=================================================================
\section{Class Browser}

クラス \ind{ブラウザー}\footnote{紛らわしいことに、「system browser」や「code browser」など呼ばれることがあります。\pharo では \ind{OmniBrowser}というブラウザーの実装が使われています。OmniBrowserは、「OB」または「Package browser」としても知られています。
この本ではシンプルに「ブラウザー」を用いますが、曖昧さが問題になるケースでは、「クラスブラウザー」と表記します。}はプログラミングにおいて、最も重要なツールの一つです。
\pharo にはいくつかのブラウザーが有りますが、どのイメージを使う場合でも、「クラスブラウザー」は最も基本的なブラウザーです。
\seeindex{クラスブラウザー}{ブラウザー}

\dothis{\menu{World \go Class browser}を選択してブラウザーを開きましょう。\footnote{もし、browser が \figref{classBrowser} に似ていなければ、デフォルトのブラウザーを変更する必要があるでしょう。\faqref{packagebrowser}を見てください。}}

\begin{figure}[htb]
\ifluluelse
	{\centerline {\includegraphics[width=\textwidth]{ClassBrowser1}}}
	{\centerline {\includegraphics[width=0.7\textwidth]{ClassBrowser1}}}
\caption{Object クラスの\ct{printString}メソッドを表示しているブラウザー。
\figlabel{classBrowser}}
\end{figure}

\figref{classBrowser}にあるのがブラウザーです。
タイトルに書かれているとおり、\clsind{Object}クラスをブラウズしています。
%\footnote{If the browser you have seems to differ from the one described in this book, you may be using an image with a different default browser. See \faqref{omnibrowser}.}

最初にブラウザーを開くと、一番左のペイン以外はすべて空欄です。
このペインは、すべての \emph{カテゴリー}をリストしています。各カテゴリーには、関連するクラスがまとめられています。
\index{category}

\dothis{\scatind{Kernel-Objects}カテゴリーをクリックしましょう。}
選択されたカテゴリーに含まれるクラスが、2番目のペインにリストされます。

\dothis{\clsind{Object}クラスを選択しましょう。}
今度は、残りの二つのペインにテキストが表示されます。
3番目のパネルは選択されたクラスの\emph{プロトコル}が表示されます。
プロトコルは、関連するメソッドを、扱いやすいようにグループ分けします。
\ind{プロトコル}を選択していなければ、すべてのメソッドが4番目のパネルに表示されます。

\dothis{\protind{printing} プロトコルを選択しましょう。}
(printing プロトコルを見つけるには、下にスクロールしなければならないかも知れません。)
printing のプロトコルに属するメソッドだけが、4番目のペインに表示されます。

\dothis{\mthind{Object}{printString}メソッドを選択しましょう。}
今度は、下のペインに、\ct{printString}メソッドのソースコードが表示されます。このソースコードは、すべてのオブジェクトで共有されます(このメソッドをオーバーライドするものを除く)。

%=================================================================
\section{クラスの検索}

\pharo でクラスを見つけるには、いくつかの方法が有ります。一つ目は、今見たように、ブラウザーのナビゲーションを使ってカテゴリからたどっていく方法です。
\index{ブラウザー}
\seeindex{ブラウザー!クラスを見つける}{クラス, 検索}
\index{クラス!検索}

二つ目として、クラスに\ct{browse}メッセージを送り、そのクラス自身のブラウザーを開く方法があります。\clsind{Boolean}クラスをブラウズしたかったとしましょう。

\dothis{ワークスペースに \ct{Boolean browse}と入力し、\menu{do it}しましょう。}
Boolean クラスについてのブラウザーが開きましたか(\figref{browseBoolean})?
クラスをブラウズする場合は、クラス名を選択して、\ind{keyboard shortcut} \short{b} (browse) を使う方法もあります。この方法は、クラス名が現われる場所なら、どのツールの中でも使えます;
\index{キーボードショートカット!browse it}
クラス名を選択して\short{b}をタイプします。

\dothis{キーボードショートカットを使って \ct{Boolean} クラスをブラウズしてみましょう。}

\begin{figure}[hbt]
\centerline {\includegraphics[width=\textwidth]{Kernel-objects-boolean}}
\caption{Boolean クラスの定義を表示しているブラウザー。
\figlabel{browseBoolean}}
\end{figure}

\ct{Boolean} クラスが選択されていて、プロトコルかメソッドが選択されていないときに、メソッドのソースコードの代わりに、\emph{クラス定義}が表示されることに注意してください(\figref{browseBoolean})。
このクラス定義は、親クラスにサブクラスの生成を依頼する、通常の \st のメッセージです。それ以上のものではありません。
ここでは、\ct{Object}クラスが、空のインスタンス変数、クラス変数、「プール辞書」を持った\ct{Boolean}というサブクラスを、\scatind{Kernel-Objects}カテゴリ内に作成するよう依頼されている様子がわかります。
% The lower pane shows the \emph{class comment} --- a piece of plain text describing the class.
\button{?} をクリックすると、\subind{クラス}{コメント}を見ることができます(\figref{classComment})。

\begin{figure}[hbt]
\centerline {\includegraphics[width=\textwidth]{classComment}}
\caption{\ct{Boolean}クラスのクラスコメント。
\figlabel{classComment}}
\end{figure}

クラスを見つける一番速い方法は、名前で検索することにかも知れません。例えば、日付と時間を表現するクラスを探しているとしましょう。

\dothis{ブラウザーのカテゴリーペインにマウスを置き、持って行き、\short{f}とタイプするか、\actclick で \menu{find class \ldots (f)}を選択し、表示されたダイアログに 「time」と入力してみましょう。} 
\noindent
「time」を含んだクラス名のリストが表示されます(\figref{findit})。\ct{Time}を選択してみましょう。ブラウザーが\ct{Time}を表示します。\ct{Time}のクラスコメントには、他のお勧めのクラスが書いてあります。これらをブラウズしたければ、その名前を選んで\short{b}をタイプします(実際は、どのテキストペインでもこの方法は使えます)。\footnote{訳注: \pharo のバージョンにより動作が微妙に異なりますが、感覚的にすぐにわかります。}
\index{キーボードショートカット!find ...}
\index{キーボードショートカット!browse it}

\begin{figure}[hbt]
\centerline{
	\includegraphics[width=0.45\textwidth]{FindIt}
	\hspace{1cm}
	\includegraphics[width=0.45\textwidth]{TimeClasses}
}
\caption{名前でクラスを検索する。
\figlabel{findit}}
\end{figure}

検索ダイアログで、完全なクラス名を入力した場合(そして単語の頭を正しく大文字化した場合)、ブラウザーは、候補リストを表示することなく、そのクラスに直行することに注意してください。

%=================================================================
\section{メソッドの検索}
\seclabel{quick:methodFinder}

メソッド名または少なくともメソッド名の一部が、クラス名よりも簡単に推測できることもあるでしょう。例えば、今現在の時間に関して、「now」や「now」を含んだメソッドがあると期待できます。しかしどこにあるのでしょう?
\emphind{method finder}は、そのような場合に重宝するツールです。
\seeindex{ブラウザー!メソッドの検索}{メソッド, 検索}
\index{メソッド!検索}

\dothis{\menu{World \go Tools ... \go Method finder}を選択し、
左上のペインに「now」を入力し、\menu{accept}しましょう(または、\textsc{return}キーを押しましょう)。\footnote{訳注: Method FinderはPharo-1.1.1までの機能です。Pharo-1.2.1以降にはありません。}}
method finder は、「now」を含むメソッド名のリストを表示します。
\ct{now}までスクロールするには、リスト表示のペインで「\ct{n}」をキーボードから入力します; すると、\ct{n}で始まる要素までスクロールします。このトリックは、すべてのスクロールするウィンドウで使えます。さてここで、「now」を選択すると、右側のペインには、このメソッドを定義しているクラスがリストされます(\figref{MethodFinder} )。クラス名を選択すると、そのクラスのブラウザーが立ち上がります。

\begin{figure}[hbt]
\centerline {\includegraphics[width=0.7\textwidth]{methodFinder-now}}
\caption{method finder。\ct{now}の定義を含んだすべてのクラスをリストしている。
\figlabel{MethodFinder}}
\end{figure}

時には、メソッドが存在することは分かっていても、それが何と呼ばれるか、見当が付かないこともあるでしょう。
method finder は、このような場合にも助けてくれます。例えば、\ct{'eureka'}を\ct{'EUREKA'}というように、アルファベット大文字に変換するメソッドを探したかったとしましょう。

\dothis{\ct{'eureka' . 'EUREKA'}と method finder に入力し、
  \textsc{return} キーを押してください
  (\figref{methodFinder-example1})。}
\noindent
method finder は、お望みのメソッドを勧めてくれましたか?\footnote{このとき、ウィンドウがポップアップして、推奨されないメソッドについて警告されても、驚かないでください --- method finder は単にありそうな候補すべてを表示するだけです。その中には、推奨されないメソッドも含まれます。慌てず騒がず、\button{Proceed}をクリックしてください。}

右のペインで、先頭にアスタリスクが付いているメソッドは、実際の変換に使われたことを示します。
このケースでは、\ct{String asUppercase}の先頭のアスタリスクが、\clsind{String}で定義された\mthind{String}{asUppercase}が、実際の\ct{'eureka' . 'EUREKA'}の変換に使われたことを示します。アスタリスクが付いていないメソッドは、単に名前が同じだと言うだけでリストされたものです。\cmind{Character}{asUppercase}は、この場合実行されていません。\ct{'eureka'}は、\clsind{Character}オブジェクトではないからです。

\begin{figure}[hbt]
\centerline {\includegraphics[width=\textwidth]{MethodFinder-example1}}
\caption{例によるメソッド検索。
\figlabel{methodFinder-example1}}
\end{figure}

引数のあるメソッドについても method finder を使うことができます; 例えば、二つの整数の最大公約数を見つけるメソッドを探すときは、\ct{25. 35. 5}を例として入力してみてください。また、複数の例を使って、検索の範囲を絞りこむことができます; 下のペインのヘルプテキストに、やり方が書いてあります。

%=================================================================
\section{メソッドを新しく定義する}

\ind{テスト駆動開発}\cite{Beck03a} (TDD\footnote{訳注: Test Driven Development})が到来してから、コードを書く方法は一変しました。
TDD の考え方は、テストを、コードそれ自身より先に書く、というものです。コードに期待する振舞いは、テストが定義します。
テストを書いて初めて、そのテストを満足させるコードを書くことができます。
\seeindex{振舞い駆動開発}{テスト駆動開発}
% \orla{describe the technique where we write a test hat ... subsequently we write ...}

「何かを大声で強調して言う」メソッドを書く、という課題があったとしましょう。これは正確にはどういうことでしょう? そのようなメソッドの名前として相応わしいのは何でしょう? 将来そのメソッドを保守するプログラマに、このメソッドが何をするべきなのか、正確に伝えるにはどうすればいいでしょう? 「例」を使えば、これらの疑問のすべてに答えることができます。

\begin{quote}
文字列「Don't panic」にメッセージ\ct{shout}を送ると、結果は「DON'T PANIC!」となる。
\end{quote}

\noindent
この例を、システムが理解できるように、テストメソッドにします。
\index{testing}
\index{SUnit}

\needlines{3}
\begin{method}[testShout]{shout メソッドのテスト}
testShout
	self assert: ('Don''t panic' shout = 'DON''T PANICBANG')
\end{method} % BANG is the escape for !

どうしたら、\pharo で新しくメソッドが作れるでしょうか? 最初に、そのメソッドがどのクラスに属するかを決めなければいけません。
この場合、今からテストしようとしている\ct{shout}メソッドが\clsind{String}クラスに属することになるので、テストは、習慣として、\clsind{StringTest}に作成します。

\begin{figure}[hbt]
\centerline {\includegraphics[width=\textwidth]{StringTest-newMethodTemplate}}
\caption{\ct{StringTest}の新規メソッドの雛形。
\figlabel{newMethodTemplate}}
\end{figure}

\dothis{\ct{StringTest}のブラウザーを開きましょう。適切なプロトコルとして、\menu{tests - converting}を選択しましょう(\figref{newMethodTemplate})。
下のペインで選択されているのは、メソッドの雛形で、\st のメソッドの概形を教えてくれます。
これを消して、先程の\mthref{testShout}で初まるコードを入力しましょう。}
ブラウザーにテキストを入力したときに、下のペインが赤く縁取りされます。これにより、入力したプログラムコードがまだ保存されていないことがわかります。
下のペインで \actclick して \menu{accept (s)}を選択するか、\short{s}をタイプして、メソッドをコンパイル・保存してください。
\index{キーボードショートカット}
\index{キーボードショートカット!accept}
\seeindex{accept it}{キーボードショートカット, accept}

このイメージで accept するのが初めてであれば、あなたの名前を入力するように促されるはずです。イメージには沢山の人がコードを寄贈し来ているので、メソッドを作った・変更したのは誰か、記録しておくことが重要なのです。単純に、ファーストネーム、ラストネームを、空白を入れずにあるいはドットで繋いで、入力します。

%\begin{figure}[hbt]
%\centerline {\includegraphics[width=0.35\textwidth]{initials}}
%\caption{Entering your initials.
%\figlabel{initials}}
%\end{figure}

\ct{shout}というメソッドは、まだ無いので、ブラウザーは、\ct{testShout}が、本当に\ct{shout}メッセージを送っていいのか確認します\,---\,同時に、他の候補もリストします(\figref{testShoutConfirm})。
タイプミスなどの時にはこの機能は非常に助かりますが、今回は\emph{本当に}作成\ct{shout}をしたいので、というのは、これが、これから作ろうとするメソッドなので、\figref{testShoutConfirm}のように、一番上の項目を選択します。


%\begin{figure}[htb]
%\begin{minipage}[b]{0.48\textwidth}
%\centerline {\includegraphics[width=0.9\textwidth]{name}}
%\caption{Entering your name.\figlabel{name}}
%\end{minipage}
%\hfill
%\begin{minipage}[b]{0.48\textwidth}
%\centerline {\includegraphics[width=\textwidth]{testShoutConfirm}}
%\caption{Accepting the \ct{StringTest} method \ct{testShout}.\figlabel{testShoutConfirm}}
%\end{minipage}
%\end{figure}

\begin{figure}[htb]
\centerline {\includegraphics[width=0.6\textwidth]{name}}
\caption{あなたの名前を入力する。\figlabel{name}}
\end{figure}

\begin{figure}[htb]
\centerline {\includegraphics[width=\textwidth]{testShoutConfirm}}
\caption{\ct{StringTest}の\ct{testShout}メソッドをacceptする。\figlabel{testShoutConfirm}}
\end{figure}


%\begin{figure}[hbt]
%\ifluluelse
%	{\centerline {\includegraphics[width=\textwidth]{testShoutConfirm}}}
%	{\centerline {\includegraphics[width=0.7\textwidth]{testShoutConfirm}}}
%\caption{Accepting the \ct{StringTest} method \ct{testShout}.
%\figlabel{testShoutConfirm}}
%\end{figure}

\dothis{今作ったテストを実行しましょう: \menu{World}から \ind{SUnit} \emphind{TestRunner}を開けましょう。}

一番左に二つ並んだペインは、ブラウザーの上部のペインに少し似ています。左側のペインはカテゴリーのリストですが、テストクラスを含んだカテゴリーに限られます。

\dothis{\scat{CollectionsTests-Text}を選択しましょう。右側のペインには、そのカテゴリーのすべてのテストクラスが表示されます。その中に、\ct{StringTest}もあります。テストクラスはすべて選択されているので、\menu{Run Selected}を \click してこれらを実行しましょう。}

\begin{figure}[hbt]
\centerline {\includegraphics[width=\textwidth]{testRunnerOnStringTest}}
\caption{StringTestを実行する。
\figlabel{testRunnerTestShout}}
\end{figure}

テストを実行した結果が、\figref{testRunnerTestShout}のように表示され、実行時エラーあったことが分かります。エラーがある箇所は右下のペインに表示されます; ご覧のとおり、\ct{StringTest>>>#testShout}が原因です。
(\st では\ct{StringTest}クラスの\mthind{StringTest}{testShout}メソッドを、\ct{StringTest>>>#testShout}と表記する習慣があります。)
\ct{StringTest>>>#testShout} をクリックすると、再度そのテストだけが実行され、\ct{MessageNotUnderstood: ByteString>>>shout}というウィンドウがポップアップします。
\seeindex{\ct{>>}}{Behavior, \ct{>>}}
\cmindex{Behavior}{>>}

エラーメッセージとともにポップアップしたこのウィンドウは、 \st のデバッガーです(\figref{predebugger})。
% \ab{Well, it's actually the \emph{pre-}debugger.  Does this matter?}\damien{I don't think it's important at this point.}
\ind{デバッガー}とその使い方については、\charef{env}で解説します。

\begin{figure}[hbt]
\centerline {\includegraphics[width=\textwidth]{Predebugger}}
\caption{(プリ)デバッガー}
\figlabel{predebugger}
\end{figure}

このエラーは、もちろん、意図したとおりのものです: 文字列が\ct{shout}するためのメソッドをまだ書いていないので、テストを実行するとエラーが発生します。
それでもなお、テストが失敗することを確認するのは良い習慣です。それによって、テスト装置が正しく設置されていることが確認できるからです。
いったんエラーを見たら、テストの実行をやめて(\button{Abandon})ウィンドウを閉じることができます。
因みに、 \st ではしばしば、まだ無いメソッドを、\button{Create}を使ってその場で書いてしまうことができます。デバッガの中で、新しく作成されたメソッドの雛形を編集し、テストを続行(\button{Proceed})することもできます。

では、テストが成功するためのメソッドを作成しましょう!

\dothis{ブラウザーで\clsind{String}クラスの\menu{converting}プロトコルを選択し、\mthref{shout}のテキストでメソッドテンプレートを上書きし、\menu{accept}しましょう。
(Note: \mbox{\ct{^}}のところには、\caret を入力します)。 }
\begin{method}[shout]{shout メソッド}
shout
	^ self asUppercase, 'BANG'
\end{method}

カンマはこの場合、文字列連結演算子になります。\ct{shout}を受け取った任意の\ct{String}オブジェクトの大文字バージョンの末尾に、感嘆符を連結します。
\pharo では、$\uparrow$以下の式が、メソッドの戻り値になります。ここでは戻り値は、連結された新しい文字列です。
\seeindex{comma}{Collection, カンマ演算子}
\index{Collection!カンマ演算子}

このメソッドは動くのでしょうか? もう一度テストを実行しましょう。

\dothis{Test Runnerで\menu{Run Selected}を再びクリックしましょう。今度は緑のバーが出て、すべてのテストが、失敗もエラーもなく実行されたことが表示されます。}
緑のバーが出たときは、仕事の成果を保存して、一休みするのがいい考えです。
さあ、一休みしましょう！
%\footnotetext{Actually, you might not get a green bar since some images contains tests for bugs that still need to be fixed.
%Don't worry about this.
%\pharo is constantly evolving.
%}

\begin{figure}[hbt]
\ifluluelse
	{\centerline{\includegraphics[width=\textwidth]{String-Shout}}}
	{\centerline{\includegraphics[width=0.7\textwidth]{String-Shout}}}
\caption{\ct{String}クラスに定義された\ct{shout}メソッド。
\figlabel{String-shout}}
\end{figure}

%=================================================================
\section{本章のまとめ}
本章では、\pharo の環境を紹介し、ブラウザー、method finder、Test Runnerと言った主なツールの使い方を学びました。\pharo の構文についても、完全にとは言わないまでも、少し学びました。

\begin{itemize}
  \item 実行中の \pharo システムは、\emph{仮想マシン}、\emph{sources}ファイル、\emph{image}ファイルと\emph{changes}ファイルで構成されており、最後の二つだけが、実行中のシステムのスナップショットとして変化していきます。
  \item \pharo イメージをロードすると、以前と全く同じ状態\,---\,実行中のオブジェクトもそのままに\,---\,イメージを保存したときとの状態が再現されます。
  \item \pharo は、3ボタンマウスを使って \click、 \actclick、 \metaclick するように設計されています。もちろん、3ボタンマウスが無くても、キーボードの修飾キーを使えば、同じことができます。
  \item \pharo の背景部分を \click すれば、\emph{World menu}が表示できます。World menuからは、様々なツールが起動できます。
  \item \emph{ワークスペース}は、コードの断片を書いて評価するためのツールです。ワークスペースにはまた、任意のテキストを書いておくこともできます。
  \item コードを評価するには、ワークスペースのテキストに\ind{キーボードショートカット}を使ったり、他のツールを使うことができます。最も重要なのは、\menu{do it} (\short{d})、\menu{print it} (\short{p})、\menu{inspect it} (\short{i})、\menu{explore it} (\short{I})、そして\menu{browse it} (\short{b})です。
%  \item \sqmap is a tool for loading useful packages from the Internet.
  \item \emph{browser}は \pharo のコードをブラウズしたり、新しくコードを開発したりするための重要なツールです。
  \item \emph{test runner}はユニットテストを実行するためのツールです。test runnerは、テスト駆動開発もサポートします。
\end{itemize}

%=================================================================
\ifx\wholebook\relax\else 
   \bibliographystyle{jurabib}
   \nobibliography{scg}
   \end{document}
\fi
%=================================================================

%%% Local Variables:
%%% coding: utf-8
%%% mode: latex
%%% TeX-master: t
%%% TeX-PDF-mode: t
%%% ispell-local-dictionary: "english"
%%% End:
